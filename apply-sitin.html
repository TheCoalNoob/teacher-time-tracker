<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Apply Sit-in</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="js/main.js"></script>
</head>
<body>
  <h2>Apply for Sit-in</h2>

  <form id="sitinForm">
    <input type="text" id="name" placeholder="Name" required><br>
    <input type="text" id="year" placeholder="Year & Section" required><br>

    <select id="room" required>
      <option value="">Select Room</option>
      <option value="419G">419G</option>
      <option value="430">430</option>
      <option value="431">431</option>
    </select><br>

    <input type="time" id="startTime" required><br>
    <input type="time" id="endTime" required><br>
    <input type="text" id="purpose" placeholder="Purpose" required><br>
    <button type="submit">Submit</button>
  </form>

  <button onclick="location.href='index.html'">Back</button>

  <script>
    document.getElementById("sitinForm").addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const year = document.getElementById("year").value;
      const room = document.getElementById("room").value;
      const start = document.getElementById("startTime").value;
      const end = document.getElementById("endTime").value;
      const purpose = document.getElementById("purpose").value;

      const schedules = getSchedules();
      let available = true;

      for (let s of schedules) {
        if (s.room === room) {
          if (isOverlap(toMinutes(start), toMinutes(end), toMinutes(s.start), toMinutes(s.end))) {
            available = false;
            break;
          }
        }
      }

      if (available) {
        const sitins = getSitins();
        const code = generateCode();
        const now = new Date();
        sitins.push({ code, name, year, room, start, end, purpose, date: now });
        saveSitins(sitins);
        alert(`✅ Approved! Your Sit-in Code: ${code}`);
      } else {
        alert("❌ Not Available! Room has a scheduled class during that time.");
      }

      e.target.reset();
    });
  </script>
</body>
</html>
